# Filmorate
## Диаграмма БД

![Диграмма БД](/src/main/resources/diagram/DBD.png)

---

# **База данных Filmorate**

Это описание структуры базы данных для проекта **Filmorate**

---

## **Содержание**
1. [Таблицы](#таблицы)
    - [Film](#film)
    - [Mpa](#mpa)
    - [Genre](#genre)
    - [Film_genre](#film_genre)
    - [Film_likes](#film_likes)
    - [User](#user)
    - [User_friendship](#user_friendship)
2. [Пример использования](#пример-использования)

---

## **Таблицы**

### **Film**
Таблица содержит информацию о фильмах.

| Поле           | Тип     | Описание                                                  |
|----------------|---------|-----------------------------------------------------------|
| `id`           | INT     | Уникальный идентификатор фильма (первичный ключ).         |
| `name`         | VARCHAR | Название фильма (уникальное).                             |
| `description`  | TEXT    | Описание фильма.                                          |
| `release_date` | DATE    | Дата выхода фильма.                                       |
| `duration`     | INT     | Продолжительность фильма в минутах (положительное число). |
| `mpa_rating`   | INT     | Идентификатор рейтинга Mpa.                               |

**Ограничения:**
- `duration > 0`

---

### **Mpa**
Таблица содержит список рейтинга Mpa.

| Поле   | Тип     | Описание                                            |
|--------|---------|-----------------------------------------------------|
| `id`   | INT     | Уникальный идентификатор рейтинга (первичный ключ). |
| `name` | VARCHAR | Название рейтинга (уникальное).                     |


### **Genre**
Таблица содержит список доступных жанров.

| Поле   | Тип     | Описание                                         |
|--------|---------|--------------------------------------------------|
| `id`   | INT     | Уникальный идентификатор жанра (первичный ключ). |
| `name` | VARCHAR | Название жанра (уникальное).                     |

---


### **Film_genre**
Таблица связывает фильмы с жанрами (многие-ко-многим).

| Поле       | Тип | Описание                             |
|------------|-----|--------------------------------------|
| `film_id`  | INT | Идентификатор фильма (внешний ключ). |
| `genre_id` | INT | Идентификатор жанра (внешний ключ).  |

**Первичный ключ:** `(film_id, genre_id)`

---

### **Film_likes**
Таблица отслеживает лайки пользователей на фильмы.

| Поле      | Тип | Описание                                   |
|-----------|-----|--------------------------------------------|
| `film_id` | INT | Идентификатор фильма (внешний ключ).       |
| `user_id` | INT | Идентификатор пользователя (внешний ключ). |

**Первичный ключ:** `(film_id, user_id)`

---

### **User**
Таблица содержит информацию о пользователях.

| Поле       | Тип     | Описание                                                |
|------------|---------|---------------------------------------------------------|
| `id`       | INT     | Уникальный идентификатор пользователя (первичный ключ). |
| `login`    | VARCHAR | Логин пользователя (уникальный).                        |
| `email`    | VARCHAR | Email пользователя (уникальный).                        |
| `name`     | VARCHAR | Имя пользователя.                                       |
| `birthday` | DATE    | Дата рождения пользователя.                             |

---

### **User_friendship**
Таблица отслеживает отношения между пользователями (дружба).

| Поле        | Тип     | Описание                                                        |
|-------------|---------|-----------------------------------------------------------------|
| `user_id`   | INT     | Идентификатор пользователя, отправившего запрос (внешний ключ). |
| `friend_id` | INT     | Идентификатор друга (внешний ключ).                             |
| `status`    | VARCHAR | Статус дружбы (`pending`, `confirmed`).                         |

**Первичный ключ:** `(user_id, friend_id)`
**Ограничение:** `user_id != friend_id` (запрет добавления себя в друзья).



---

## **Пример использования**

1. **Получение жанров:**
   ```sql
    SELECT g.NAME genre_name
    FROM   film f
           JOIN film_genre fg
             ON f.id = fg.film_id
           JOIN genre g
             ON fg.genre_id = g.id
    WHERE  f.NAME = '1+1';
   ```
2. **Получение количества лайков у фильма:** 
    ```sql
    SELECT COUNT(fl) likes_count
    FROM   film f
           INNER JOIN film_likes fl
                   ON f.id = fl.film_id
    WHERE  f.id = 2
    ```
3. **Нахождение общих друзей** 
    ```sql
    SELECT uf1.friend_id AS common_friend_id
    FROM   user_friendship uf1
           INNER JOIN user_friendship uf2
                   ON uf1.friend_id = uf2.friend_id
    WHERE  uf1.user_id = 1
           AND uf2.user_id = 2
           AND uf1.status = 'confirmed'
           AND uf2.status = 'confirmed';
    ```
---